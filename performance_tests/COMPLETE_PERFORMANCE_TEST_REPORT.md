# 系统性能测试完整报告

## 测试概述

**测试日期**: 2026-01-16  
**测试环境**: http://localhost:3000  
**测试数据**: 
- 模拟ID: `inference_1751611329_20221008`
- 时间步: `waterdepth_20221008_000000`
- 测试瓦片: `z=14, x=931, y=619`

**测试目标**:
1. REST API响应时间（P50/P95/P99）
2. 吞吐量（requests/sec）
3. 并发处理能力
4. 实时从GeoTIFF生成瓦片的速度

---

## 1. REST API响应时间（P50/P95/P99）

### 1.1 瓦片生成端点 - 缓存未命中

**端点**: `GET /api/tiles/{simulation_id}/{timestep_id}/{z}/{x}/{y}.png`

| 指标 | 数值 | 说明 |
|------|------|------|
| 测试请求数 | 10 | 不同瓦片坐标（确保缓存未命中） |
| **P50 (中位数)** | **16ms** | 50%的请求在此时间内完成 |
| **P95** | **88ms** | 95%的请求在此时间内完成 |
| **P99** | **88ms** | 99%的请求在此时间内完成 |
| 平均响应时间 | 22ms | |
| 最小响应时间 | 15ms | |
| 最大响应时间 | 88ms | |

**评估**: ✅ **优秀** - 实时从GeoTIFF生成瓦片的性能优秀，P95为88ms，远低于500ms的目标。

**关键发现**:
- 第一个请求（88ms）可能是系统预热或首次加载导致的
- 后续请求都在16ms左右，性能稳定
- 实时瓦片生成速度非常快

### 1.2 瓦片生成端点 - 缓存命中

**端点**: `GET /api/tiles/{simulation_id}/{timestep_id}/{z}/{x}/{y}.png`

| 指标 | 数值 | 说明 |
|------|------|------|
| 测试请求数 | 50 | 相同瓦片坐标（缓存命中） |
| **P50 (中位数)** | **7ms** | |
| **P95** | **8ms** | |
| **P99** | **11ms** | |
| 平均响应时间 | 7ms | |
| 最小响应时间 | 7ms | |
| 最大响应时间 | 11ms | |

**评估**: ✅ **优秀** - 缓存命中后性能优异，响应时间非常稳定。

### 1.3 缓存效果分析

| 场景 | 平均响应时间 | P50 | P95 | P99 | 性能提升 |
|------|-------------|-----|-----|-----|---------|
| 缓存未命中 | 22ms | 16ms | 88ms | 88ms | 基准 |
| 缓存命中 | 7ms | 7ms | 8ms | 11ms | **3.14x** |

**关键发现**:
1. **缓存加速比**: 3.14倍
2. **响应时间降低**: 从22ms降低到7ms，降低了约68%
3. **稳定性提升**: P95从88ms降低到8ms，提升了约90%

**结论**: 缓存机制非常有效，显著提升了瓦片生成的性能。

---

## 2. 吞吐量测试（requests/sec）

### 2.1 测试方法

- **测试端点**: `/api/tiles/inference_1751611329_20221008/waterdepth_20221008_000000/14/931/619.png`
- **测试持续时间**: 每个并发级别持续30秒
- **并发级别**: 1, 5, 10, 20, 50

### 2.2 测试结果

| 并发数 | 持续时间(秒) | 总请求数 | 成功数 | 失败数 | **吞吐量(req/s)** | 平均响应时间(ms) | P50(ms) | P95(ms) | P99(ms) |
|--------|------------|---------|--------|--------|------------------|----------------|---------|---------|---------|
| 1 | 30 | 1,395 | 1,395 | 0 | **46** | 7 | 8 | 9 | 10 |
| 5 | 30 | 6,452 | 6,452 | 0 | **215** | 9 | 9 | 16 | 28 |
| 10 | 30 | 11,064 | 11,064 | 0 | **368** | 12 | 12 | 17 | 23 |
| 20 | 30 | 10,944 | 10,944 | 0 | **364** | 40 | 38 | 46 | 94 |
| 50 | 30 | 11,324 | 11,324 | 0 | **377** | 117 | 116 | 129 | 160 |

### 2.3 吞吐量分析

**关键发现**:
- **最大吞吐量**: **377 requests/sec** (在并发数为50时达到)
- **最优并发数**: 10-20之间，吞吐量达到368-364 req/s，响应时间保持在较低水平
- **性能趋势**:
  - 并发数从1增加到10时，吞吐量线性增长（46 → 368 req/s）
  - 并发数从10增加到50时，吞吐量增长放缓（368 → 377 req/s），但响应时间显著增加（12ms → 117ms）
  - 在并发数20-50之间，吞吐量基本稳定在364-377 req/s

**性能曲线**:
```
吞吐量 (req/s)
400 |                                    ●
350 |                        ●
300 |            ●
250 |    ●
200 |●
150 |
100 |
 50 |●
  0 +----+----+----+----+----+----+----+----+----+----+
    0    5   10   15   20   25   30   35   40   45   50
                    并发数
```

**评估**: ✅ **优秀** - 系统在中等并发（10-20）下达到最佳吞吐量，最大吞吐量达到377 req/s。

---

## 3. 并发处理能力测试

### 3.1 测试方法

- **测试端点**: `/api/tiles/inference_1751611329_20221008/waterdepth_20221008_000000/14/931/619.png`
- **测试模式**: 每个并发级别发送固定数量的请求（每并发100请求）
- **并发级别**: 1, 5, 10, 20, 50, 100

### 3.2 测试结果

| 并发数 | 总请求数 | 成功数 | 失败数 | 总时间(秒) | **吞吐量(req/s)** | 平均响应时间(ms) | P50(ms) | P95(ms) | P99(ms) | **错误率(%)** |
|--------|---------|--------|--------|-----------|------------------|----------------|---------|---------|---------|--------------|
| 1 | 100 | 100 | 0 | 1 | **100** | 8 | 8 | 11 | 22 | **0.00** |
| 5 | 500 | 500 | 0 | 1 | **500** | 11 | 11 | 14 | 16 | **0.00** |
| 10 | 1,000 | 1,000 | 0 | 2 | **500** | 23 | 24 | 26 | 44 | **0.00** |
| 20 | 2,000 | 2,000 | 0 | 5 | **400** | 50 | 50 | 53 | 120 | **0.00** |
| 50 | 5,000 | 5,000 | 0 | 13 | **384** | 132 | 130 | 154 | 224 | **0.00** |
| 100 | 10,000 | 10,000 | 0 | 26 | **384** | 264 | 260 | 292 | 394 | **0.00** |

### 3.3 并发能力分析

**关键发现**:
- **零错误率**: 在所有测试并发级别（1-100）下，错误率均为0%，系统非常稳定
- **最大并发数（错误率<1%）**: **100并发**
- **最大并发数（错误率<5%）**: **100并发**
- **性能趋势**:
  - 并发数1-5: 吞吐量快速增长（100 → 500 req/s），响应时间保持在低水平（8-11ms）
  - 并发数5-10: 吞吐量保持稳定（500 req/s），响应时间略有增加（11-23ms）
  - 并发数10-50: 吞吐量略有下降（500 → 384 req/s），响应时间显著增加（23-132ms）
  - 并发数50-100: 吞吐量保持稳定（384 req/s），响应时间继续增加（132-264ms）

**响应时间曲线**:
```
响应时间 (ms)
300 |                                    ●
250 |                            ●
200 |                    ●
150 |            ●
100 |    ●
 50 |        ●
  0 |●
  0 +----+----+----+----+----+----+----+----+----+----+
    0   10   20   30   40   50   60   70   80   90  100
                    并发数
```

**评估**: ✅ **优秀** - 系统在100并发下仍能保持零错误率，并发处理能力非常强。

---

## 4. 实时从GeoTIFF生成瓦片的速度

### 4.1 测试结果汇总

| 指标 | 缓存未命中 | 缓存命中 | 说明 |
|------|-----------|---------|------|
| **平均响应时间** | **22ms** | **7ms** | 实时生成瓦片的平均时间 |
| **P50响应时间** | **16ms** | **7ms** | 中位数响应时间 |
| **P95响应时间** | **88ms** | **8ms** | 95%的请求在此时间内完成 |
| **P99响应时间** | **88ms** | **11ms** | 99%的请求在此时间内完成 |
| **最小响应时间** | 15ms | 7ms | |
| **最大响应时间** | 88ms | 11ms | |

### 4.2 性能评估

**实时生成性能**:
- ✅ **平均响应时间**: 22ms（缓存未命中）
- ✅ **P95响应时间**: 88ms（缓存未命中）
- ✅ **性能目标**: 远低于500ms的目标，超出目标5.68倍

**缓存性能**:
- ✅ **平均响应时间**: 7ms（缓存命中）
- ✅ **缓存加速比**: 3.14倍
- ✅ **性能提升**: 响应时间降低68%，P95提升90%

**评估**: ✅ **优秀** - 实时从GeoTIFF生成瓦片的速度非常快，完全满足实时地图渲染的需求。

---

## 5. 综合性能分析

### 5.1 性能指标总结表

| 测试项目 | 指标 | 结果 | 评估 |
|---------|------|------|------|
| **REST API响应时间** | P50 | 7-16ms | ✅ 优秀 |
| | P95 | 8-88ms | ✅ 优秀 |
| | P99 | 11-88ms | ✅ 优秀 |
| **吞吐量** | 最大吞吐量 | 377 req/s | ✅ 优秀 |
| | 最优并发数 | 10-20 | ✅ 优秀 |
| **并发处理能力** | 最大并发数（错误率<1%） | 100 | ✅ 优秀 |
| | 最大并发数（错误率<5%） | 100 | ✅ 优秀 |
| **实时瓦片生成** | 平均响应时间（缓存未命中） | 22ms | ✅ 优秀 |
| | P95响应时间（缓存未命中） | 88ms | ✅ 优秀 |
| | 缓存加速比 | 3.14x | ✅ 优秀 |

### 5.2 性能目标达成情况

| 指标 | 目标 | 实际结果 | 达成度 | 状态 |
|------|------|---------|--------|------|
| 瓦片生成（缓存命中）P95 | < 50ms | 8ms | **625%** | ✅ 超标 |
| 瓦片生成（实时）P95 | < 500ms | 88ms | **568%** | ✅ 超标 |
| 吞吐量 | > 100 req/s | 377 req/s | **377%** | ✅ 超标 |
| 并发处理能力 | > 50并发 | 100并发（0%错误率） | **200%** | ✅ 超标 |

**总结**: 所有指标都远超预期目标，系统性能优秀。

### 5.3 系统优势

1. **响应时间优秀**: 
   - 缓存命中时P95仅8ms
   - 实时生成时P95仅88ms
   - 所有百分位数都在合理范围内

2. **吞吐量高**: 
   - 最大吞吐量达到377 req/s
   - 在10-20并发下达到最优性能

3. **并发能力强**: 
   - 支持100并发，错误率为0%
   - 系统稳定性极佳

4. **缓存效果显著**: 
   - 缓存加速比3.14倍
   - 显著提升用户体验

5. **实时生成性能优秀**: 
   - 平均22ms完成实时瓦片生成
   - 完全满足实时地图渲染需求

### 5.4 性能瓶颈分析

1. **并发数>20时响应时间增加**:
   - 并发数从20增加到50时，响应时间从40ms增加到117ms
   - 建议：在10-20并发下运行以获得最佳性能

2. **高并发下吞吐量稳定但响应时间增加**:
   - 并发数50-100时，吞吐量稳定在384 req/s，但响应时间增加到264ms
   - 建议：根据应用场景选择合适的并发数

---

## 6. 用于Journal文章的关键数据

### 6.1 响应时间对比表

```
端点类型          | P50  | P95  | P99  | 平均
-----------------|------|------|------|------
瓦片（缓存命中）   | 7ms  | 8ms  | 11ms | 7ms
瓦片（缓存未命中） | 16ms | 88ms | 88ms | 22ms
```

### 6.2 吞吐量测试结果表

```
并发数 | 吞吐量(req/s) | 平均响应时间(ms) | P50(ms) | P95(ms) | P99(ms)
-------|--------------|----------------|---------|---------|--------
1      | 46           | 7              | 8       | 9       | 10
5      | 215          | 9              | 9       | 16      | 28
10     | 368          | 12             | 12      | 17      | 23
20     | 364          | 40             | 38      | 46      | 94
50     | 377          | 117            | 116     | 129     | 160
```

### 6.3 并发处理能力测试结果表

```
并发数 | 总请求数 | 成功数 | 错误率(%) | 吞吐量(req/s) | 平均响应时间(ms) | P50(ms) | P95(ms) | P99(ms)
-------|---------|--------|-----------|--------------|----------------|---------|---------|--------
1      | 100     | 100    | 0.00      | 100          | 8              | 8       | 11      | 22
5      | 500     | 500    | 0.00      | 500          | 11             | 11      | 14      | 16
10     | 1,000   | 1,000  | 0.00      | 500          | 23             | 24      | 26      | 44
20     | 2,000   | 2,000  | 0.00      | 400          | 50             | 50      | 53      | 120
50     | 5,000   | 5,000  | 0.00      | 384          | 132            | 130     | 154     | 224
100    | 10,000  | 10,000 | 0.00      | 384          | 264            | 260     | 292     | 394
```

### 6.4 缓存效果对比

```
场景          | 平均响应时间 | P50 | P95 | P99 | 加速比
-------------|------------|-----|-----|-----|-------
缓存未命中    | 22ms       | 16ms| 88ms| 88ms| 1.0x
缓存命中      | 7ms        | 7ms | 8ms | 11ms| 3.14x
```

### 6.5 性能目标达成情况

```
指标                    | 目标    | 实际结果 | 达成度
----------------------|---------|---------|-------
瓦片生成（缓存）P95     | < 50ms  | 8ms     | 625%
瓦片生成（实时）P95     | < 500ms | 88ms    | 568%
最大吞吐量              | > 100   | 377     | 377%
最大并发数（错误率<1%） | > 50    | 100     | 200%
```

---

## 7. 结论

本次性能测试全面验证了系统的核心性能指标，所有测试结果均达到或远超预期目标：

1. ✅ **REST API响应时间**: 
   - 缓存命中时P95仅8ms
   - 实时生成时P95仅88ms
   - 所有百分位数都在优秀范围内

2. ✅ **吞吐量**: 
   - 最大吞吐量达到377 requests/sec
   - 在10-20并发下达到最优性能

3. ✅ **并发处理能力**: 
   - 支持100并发，错误率为0%
   - 系统稳定性极佳

4. ✅ **实时瓦片生成速度**: 
   - 平均22ms完成实时瓦片生成
   - P95为88ms，远超500ms的目标

**总体评估**: 系统性能优秀，所有关键指标都远超预期目标，完全满足实时地图渲染和洪水预测系统的性能需求。

---

## 8. 测试数据文件

详细测试数据保存在以下文件中：

- `test_results/throughput_results.csv` - 吞吐量测试详细数据
- `test_results/concurrent_capacity_results.csv` - 并发处理能力测试详细数据
- `test_results/performance_test_20260116_180620.txt` - 响应时间测试详细数据
- `test_results/throughput_concurrent_summary_20260116_181440.txt` - 吞吐量和并发测试汇总

---

**报告生成时间**: 2026-01-16  
**测试环境**: http://localhost:3000  
**测试工具**: 
- `simple_performance_test.sh` (响应时间测试)
- `throughput_concurrent_test.sh` (吞吐量和并发测试)
