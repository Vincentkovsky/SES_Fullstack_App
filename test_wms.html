<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MapServer WMS Test</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.1.0/ol.css">
    <script src="https://cdn.jsdelivr.net/npm/ol@v7.1.0/dist/ol.js"></script>
    <style>
        #map {
            width: 100%;
            height: 600px;
        }
        .controls {
            margin: 20px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>MapServer WMS Test</h1>
    
    <div class="controls">
        <p>
            <label for="simulation">Simulation:</label>
            <select id="simulation">
                <option value="20221024_20221022">20221024_20221022</option>
                <option value="20221024_20221030">20221024_20221030</option>
            </select>
        </p>
        <p>
            <label for="timestamp">Timestamp:</label>
            <select id="timestamp">
                <option value="20221024_000000">20221024_000000</option>
                <option value="20221024_003000">20221024_003000</option>
                <option value="20221024_010000">20221024_010000</option>
                <option value="20221024_013001">20221024_013001</option>
                <option value="20221024_020000">20221024_020000</option>
                <option value="20221024_023001">20221024_023001</option>
            </select>
        </p>
        <button id="update">Update Map</button>
    </div>
    
    <div id="map"></div>

    <script>
        // Initialize map and WMS layer
        var wmsSource = new ol.source.ImageWMS({
            url: 'http://localhost:3000/api/mapserver/map/20221024_20221022',
            params: {
                'LAYERS': 'waterdepth_20221024_000000',
                'FORMAT': 'image/png',
                'TRANSPARENT': true
            },
            serverType: 'mapserver'
        });

        var wmsLayer = new ol.layer.Image({
            source: wmsSource
        });

        var map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                }),
                wmsLayer
            ],
            view: new ol.View({
                projection: 'EPSG:3857',
                center: ol.proj.fromLonLat([147.35, -35.12]), // Approximate center for Wagga Wagga
                zoom: 12
            })
        });

        // Update map on button click
        document.getElementById('update').addEventListener('click', function() {
            var simulation = document.getElementById('simulation').value;
            var timestamp = document.getElementById('timestamp').value;
            
            // Update WMS source URL and parameters
            wmsSource.setUrl('http://localhost:3000/api/mapserver/map/' + simulation);
            wmsSource.updateParams({
                'LAYERS': 'waterdepth_' + timestamp,
                'timestamp': timestamp
            });
        });
    </script>
</body>
</html> 